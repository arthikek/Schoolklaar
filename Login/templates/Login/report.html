{% extends 'base.html' %}




{% block content %}



<button class="btn btn-primary" type="button" id="pdfButton">Download pdf</button>
<div class="container" id="contentToPDF">
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-8">
        <div class="card">
          <div class="card-body">
            <h1 class="card-title">{{ object.naam|title }} {{ object.achternaam|title}}</h1>
            <p class="card-text">
              <strong>School:</strong> {{ object.school }}<br>
              <strong>Niveau:</strong> {{ object.niveau }}<br>
              <strong>Klas:</strong> {{ object.klas }}<br>
              <strong>Email:</strong> {{ object.email }}
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <h2>Grafieken</h2>
  <div class="html2pdf__page-break ">
    <div class="chart-container " style="position: relative; height:40vh; width:80vw">
      <canvas id="kennisChart"></canvas>
    </div>
    <div class="chart-container html2pdf__page-break" style="position: relative; height:40vh; width:80vw">
      <canvas id="werkhoudingChart"></canvas>
    </div>
    <div class="chart-container " style="position: relative; height:40vh; width:80vw">
      <canvas id="inzichtChart"></canvas>
    </div>
    
  </div>
  
  <h2>Sessies</h2>
  {% for sessie in object.sessie_set.all %}

  <div class="card mb-3 {% if forloop.counter|divisibleby:2 %}html2pdf__page-break{% endif %}">
    <div class="card-header">
      <h5 class="card-title">{{ sessie.datum }}</h5>
      <h6 class="card-subtitle text-muted"><a href="{% url 'Login:student_detail' leerling.pk %}">{{sessie.Leerling.naam|title}} {{sessie.Leerling.achternaam|title}}</a></h6>
    </div>
    <div class="card-body d-flex flex-wrap">
      <div class="p-2">Begeleider: {{ sessie.begeleider }}</div>
      <div class="p-2">School: {{ sessie.Leerling.school }}</div>
      <div class="p-2">Niveau: {{ sessie.Leerling.niveau }}</div>
      <div class="p-2">Klas: {{ sessie.Leerling.klas }}</div>
      <div class="p-2">Vak: {{ sessie.vak }}</div>
      <div class="p-2">Inzicht: {{ sessie.inzicht }}</div>
      <div class="p-2">Kennis: {{ sessie.kennis }}</div>
      <div class="p-2">Werkhouding: {{ sessie.werkhouding }}</div>
    </div>
    <div class="card-footer">
      <h5 class="card-title">Extra Info</h5>
      <p class="card-text">{{ sessie.extra }}</p>
    </div>
  </div>
{% endfor %}


</div>


  


  {% block javascript %}

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    $(document).ready(function () {
      console.log('document ready');
      var element = document.getElementById('contentToPDF');
      console.log('form: ', element);
      var mode =  {  mode: 'legacy' };
      var opt = {
        filename: "{{object.naam|title}}" + "" + "{{object.naam|title}} "+ '.pdf',
        pagebreak: mode,
        jsPDF: {orientation: 'portrait', unit: 'mm', format: 'A4', compressPDF: false},
        html2canvas: {scale:5}
      };
    
      $('#pdfButton').on('click', function () {
        // Add the class to adjust layout
        document.body.classList.add('left-align');
    
        // Generate the PDF
        html2pdf().from(element).set(opt).save().then(function() {
          // Once the PDF is generated, remove the class
          document.body.classList.remove('left-align');
        });
      });
    });
    
    

    console.log("{{ object.pk }}")
    $.ajax({
      url: "{% url 'Login:api_sessie' %}",
      data: {
        'leerling': "{{ object.pk }}",
      },
      type: 'get',
      dataType: 'json',
      success: function (data) {

      
        console.log(data);
        var sessies = data;

        // Initialize empty lists for kennis, werkhouding, inzicht
        var kennisList = [];
        var werkhoudingList = [];
        var inzichtList = [];

        // Loop through each session
        sessies.forEach(function (sessie) {
          // Add values to the respective lists
          kennisList.push(sessie.kennis);
          werkhoudingList.push(sessie.werkhouding);
          inzichtList.push(sessie.inzicht);
        });

        // Log the lists
        console.log("Kennis: ", kennisList);
        console.log("Werkhouding: ", werkhoudingList);
        console.log("Inzicht: ", inzichtList);
        var labels = data.map(function (sessie, index) {
          return "Sessie " + (index + 1);
        });

        function createChart(elementId, chartLabel, chartData) {
          new Chart(document.getElementById(elementId), {
            type: 'line',
            data: {
              labels: labels,
              datasets: [{
                label: chartLabel,
                data: chartData,
                backgroundColor: 'rgb(4, 50, 77)',
                fill: true,
                borderColor: 'rgb(255, 255, 255)',
                tension: 0.2
              }],
              options: {
                legend: {
                    display: false // this will hide the legend
                }
            }
        }});
        }

        createChart('kennisChart', 'Kennis', kennisList);
        createChart('werkhoudingChart', 'Werkhouding', werkhoudingList);
        createChart('inzichtChart', 'Inzicht', inzichtList);
      }
    });

  </script>

  {% endblock javascript %}

  {% endblock content %}